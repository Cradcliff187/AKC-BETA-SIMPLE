<script>
(function() {
  // === Standardized Loading Overlay ===
  const StandardLoadingOverlay = ({ message = 'Loading...' }) => {
    return React.createElement('div', {
      className: 'absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50'
    }, 
      React.createElement('div', { 
        className: 'text-center flex flex-col items-center justify-center' 
      },
        // Spinner SVG
        React.createElement('svg', {
          className: 'animate-spin h-10 w-10 text-blue-600 mb-4',
          xmlns: 'http://www.w3.org/2000/svg',
          fill: 'none',
          viewBox: '0 0 24 24'
        },
          React.createElement('circle', {
            className: 'opacity-25',
            cx: '12',
            cy: '12',
            r: '10',
            stroke: 'currentColor',
            strokeWidth: '4'
          }),
          React.createElement('path', {
            className: 'opacity-75',
            fill: 'currentColor',
            d: 'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'
          })
        ),
        // Loading text
        React.createElement('span', { 
          className: 'text-lg text-gray-700 font-semibold' 
        }, message)
      )
    );
  };

  // === Standardized Table Component ===
  const StandardTable = ({ 
    columns,     // Array of column definitions
    data,        // Filtered data
    onRowClick   // Handler for row selection
  }) => {
    return React.createElement('div', { className: 'bg-white rounded-lg shadow overflow-hidden' },
      React.createElement('table', { className: 'min-w-full divide-y divide-gray-200' },
        // Table Header
        React.createElement('thead', { className: 'bg-gray-50' },
          React.createElement('tr', null,
            columns.map(col => 
              React.createElement('th', {
                key: col.key,
                className: 'px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider'
              }, col.label)
            )
          )
        ),
        // Table Body
        React.createElement('tbody', { className: 'bg-white divide-y divide-gray-200' },
          data.map(item => 
            React.createElement('tr', { 
              key: item.subId,
              onClick: () => onRowClick(item),
              className: 'hover:bg-gray-50 cursor-pointer'
            },
              columns.map(col => 
                React.createElement('td', {
                  key: col.key,
                  className: 'px-3 py-2 whitespace-nowrap text-sm text-gray-900'
                }, 
                  col.render ? col.render(item) : (item[col.key] || 'N/A')
                )
              )
            )
          )
        )
      )
    );
  };

  // === Create Subcontractor Form Component ===
  const CreateSubcontractorForm = ({ onSubmit, onCancel }) => {
    const [formData, setFormData] = React.useState({
      subName: '',
      address: '',
      city: '',
      state: '',
      zip: '',
      contactEmail: '',
      phone: ''
    });

    const handleSubmit = (e) => {
      e.preventDefault();
      if (!formData.subName.trim()) return;
      onSubmit(formData);
    };

    // Phone number formatter
    const formatPhoneNumber = (value) => {
      const cleaned = value.replace(/\D/g, '');
      if (cleaned.length >= 10) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6,10)}`;
      } else if (cleaned.length > 6) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6)}`;
      } else if (cleaned.length > 3) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3)}`;
      } else if (cleaned.length > 0) {
        return `(${cleaned}`;
      }
      return cleaned;
    };

    return React.createElement('div', { className: 'space-y-4 bg-white p-6 rounded-lg shadow' },
      React.createElement('h3', { className: 'text-lg font-semibold' }, 'Create New Subcontractor'),
      React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
        // Subcontractor Name (required)
        React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Subcontractor Name *'),
          React.createElement('input', {
            type: 'text',
            required: true,
            value: formData.subName,
            onChange: e => setFormData(prev => ({ ...prev, subName: e.target.value })),
            className: 'w-full p-2 border rounded'
          })
        ),
        // Address
        React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Address'),
          React.createElement('input', {
            type: 'text',
            value: formData.address,
            onChange: e => setFormData(prev => ({ ...prev, address: e.target.value })),
            className: 'w-full p-2 border rounded'
          })
        ),
        // City, State, Zip
        React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'City'),
            React.createElement('input', {
              type: 'text',
              value: formData.city,
              onChange: e => setFormData(prev => ({ ...prev, city: e.target.value })),
              className: 'w-full p-2 border rounded'
            })
          ),
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'State'),
            React.createElement('input', {
              type: 'text',
              maxLength: 2,
              value: formData.state,
              onChange: e => setFormData(prev => ({ ...prev, state: e.target.value.toUpperCase() })),
              className: 'w-full p-2 border rounded'
            })
          ),
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ZIP'),
            React.createElement('input', {
              type: 'text',
              maxLength: 5,
              value: formData.zip,
              onChange: e => setFormData(prev => ({ 
                ...prev, 
                zip: e.target.value.replace(/\D/g, '').slice(0, 5)
              })),
              className: 'w-full p-2 border rounded'
            })
          )
        ),
        // Contact Info
        React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Phone'),
            React.createElement('input', {
              type: 'tel',
              value: formData.phone,
              onChange: e => setFormData(prev => ({ 
                ...prev, 
                phone: formatPhoneNumber(e.target.value)
              })),
              className: 'w-full p-2 border rounded'
            })
          ),
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Email'),
            React.createElement('input', {
              type: 'email',
              value: formData.contactEmail,
              onChange: e => setFormData(prev => ({ ...prev, contactEmail: e.target.value })),
              className: 'w-full p-2 border rounded'
            })
          )
        ),
        // Buttons
        React.createElement('div', { className: 'flex justify-end space-x-4 pt-4' },
          React.createElement('button', {
            type: 'button',
            onClick: onCancel,
            className: 'px-4 py-2 border rounded hover:bg-gray-50'
          }, 'Cancel'),
          React.createElement('button', {
            type: 'submit',
            className: 'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700'
          }, 'Create Subcontractor')
        )
      )
    );
  };

  // === Edit Subcontractor Form Component ===
  const EditSubcontractorForm = ({ subcontractor, onSubmit, onCancel }) => {
    const [formData, setFormData] = React.useState({
      subId: subcontractor.subId,
      subName: subcontractor.subName || '',
      address: subcontractor.address || '',
      city: subcontractor.city || '',
      state: subcontractor.state || '',
      zip: subcontractor.zip || '',
      contactEmail: subcontractor.contactEmail || '',
      phone: subcontractor.phone || ''
    });

    const handleSubmit = (e) => {
      e.preventDefault();
      onSubmit(formData);
    };

    // Phone number formatter
    const formatPhoneNumber = (value) => {
      const cleaned = value.replace(/\D/g, '');
      if (cleaned.length >= 10) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6,10)}`;
      } else if (cleaned.length > 6) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6)}`;
      } else if (cleaned.length > 3) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3)}`;
      } else if (cleaned.length > 0) {
        return `(${cleaned}`;
      }
      return cleaned;
    };

    return React.createElement('div', { className: 'space-y-4 bg-white p-6 rounded-lg shadow' },
      React.createElement('h3', { className: 'text-lg font-semibold' }, 'Edit Subcontractor'),
      React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
        // Subcontractor Name (required)
        React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Subcontractor Name *'),
          React.createElement('input', {
            type: 'text',
            required: true,
            value: formData.subName,
            onChange: e => setFormData(prev => ({ ...prev, subName: e.target.value })),
            className: 'w-full p-2 border rounded'
          })
        ),
        // Address
        React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Address'),
          React.createElement('input', {
            type: 'text',
            value: formData.address,
            onChange: e => setFormData(prev => ({ ...prev, address: e.target.value })),
            className: 'w-full p-2 border rounded'
          })
        ),
        // City, State, Zip
        React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'City'),
            React.createElement('input', {
              type: 'text',
              value: formData.city,
              onChange: e => setFormData(prev => ({ ...prev, city: e.target.value })),
              className: 'w-full p-2 border rounded'
            })
          ),
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'State'),
            React.createElement('input', {
              type: 'text',
              maxLength: 2,
              value: formData.state,
              onChange: e => setFormData(prev => ({ ...prev, state: e.target.value.toUpperCase() })),
              className: 'w-full p-2 border rounded'
            })
          ),
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ZIP'),
            React.createElement('input', {
              type: 'text',
              maxLength: 5,
              value: formData.zip,
              onChange: e => setFormData(prev => ({ 
                ...prev, 
                zip: e.target.value.replace(/\D/g, '').slice(0, 5)
              })),
              className: 'w-full p-2 border rounded'
            })
          )
        ),
        // Contact Info
        React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Phone'),
            React.createElement('input', {
              type: 'tel',
              value: formData.phone,
              onChange: e => setFormData(prev => ({ 
                ...prev, 
                phone: formatPhoneNumber(e.target.value)
              })),
              className: 'w-full p-2 border rounded'
            })
          ),
          React.createElement('div', null,
            React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Email'),
            React.createElement('input', {
              type: 'email',
              value: formData.contactEmail,
              onChange: e => setFormData(prev => ({ ...prev, contactEmail: e.target.value })),
              className: 'w-full p-2 border rounded'
            })
          )
        ),
        // Buttons
        React.createElement('div', { className: 'flex justify-end space-x-4 pt-4' },
          React.createElement('button', {
            type: 'button',
            onClick: onCancel,
            className: 'px-4 py-2 border rounded hover:bg-gray-50'
          }, 'Cancel'),
          React.createElement('button', {
            type: 'submit',
            className: 'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700'
          }, 'Update Subcontractor')
        )
      )
    );
  };

  // === Main SubcontractorManagement Component ===
  const SubcontractorManagement = ({ showMessage, loading: parentLoading, setLoading: setParentLoading, onUpdate }) => {
    // Remove local loading state, use parent's exclusively
    const setLoading = setParentLoading;
    const mountedRef = React.useRef(true);

    // State management
    const [subcontractors, setSubcontractors] = React.useState([]);
    const [filteredSubcontractors, setFilteredSubcontractors] = React.useState([]);
    const [selectedSubcontractor, setSelectedSubcontractor] = React.useState(null);
    const [viewMode, setViewMode] = React.useState('list');
    const [isCreating, setIsCreating] = React.useState(false);
    const [isEditing, setIsEditing] = React.useState(false);
    const [searchTerm, setSearchTerm] = React.useState('');
    const [statusFilter, setStatusFilter] = React.useState('All');

    // === Data Fetching with Better Error Handling ===
    const fetchSubcontractors = React.useCallback(() => {
      if (!mountedRef.current) return;
      setLoading(true);

      return new Promise((resolve, reject) => {
        google.script.run
          .withSuccessHandler(response => {
            if (!mountedRef.current) return;
            if (response && response.success) {
              setSubcontractors(response.data || []);
              setFilteredSubcontractors(response.data || []);
              resolve(response.data);
            } else {
              const error = response?.error || 'Failed to load subcontractors';
              showMessage(error, 'error');
              reject(new Error(error));
            }
            setLoading(false);
          })
          .withFailureHandler(error => {
            if (!mountedRef.current) return;
            console.error('Error fetching subcontractors:', error);
            showMessage('Failed to load subcontractors', 'error');
            setLoading(false);
            reject(error);
          })
          .getSubcontractorsForClient();
      });
    }, [setLoading, showMessage]);

    // Cleanup on unmount
    React.useEffect(() => {
      return () => {
        mountedRef.current = false;
      };
    }, []);

    // Initial fetch with error boundary
    React.useEffect(() => {
      fetchSubcontractors().catch(error => {
        console.error('Error in initial subcontractor fetch:', error);
      });
    }, [fetchSubcontractors]);

    // === Search and Filter Effect ===
    React.useEffect(() => {
      let filtered = [...subcontractors];
      
      if (searchTerm.trim()) {
        const searchLower = searchTerm.toLowerCase();
        filtered = filtered.filter(sub => 
          sub.subName.toLowerCase().includes(searchLower) ||
          sub.subId.toLowerCase().includes(searchLower) ||
          sub.contactEmail?.toLowerCase().includes(searchLower) ||
          sub.phone?.includes(searchTerm)
        );
      }

      if (statusFilter !== 'All') {
        filtered = filtered.filter(sub => sub.status === statusFilter);
      }

      setFilteredSubcontractors(filtered);
    }, [searchTerm, statusFilter, subcontractors]);

    // === Handlers ===
    const handleCreateSubcontractor = async (formData) => {
      setLoading(true);
      
      try {
        const cleanedData = {
          subName: formData.subName.trim(),
          address: formData.address.trim(),
          city: formData.city.trim(),
          state: formData.state.trim(),
          zip: formData.zip.trim(),
          contactEmail: formData.contactEmail.trim(),
          phone: formatPhoneNumber(formData.phone)
        };

        const response = await new Promise((resolve, reject) => {
          google.script.run
            .withSuccessHandler(result => {
              if (result === null) {
                // Handle null response by fetching latest subcontractors
                google.script.run
                  .withSuccessHandler(subcontractorsResult => {
                    if (subcontractorsResult && subcontractorsResult.success) {
                      // Find our newly created subcontractor
                      const foundSubcontractor = subcontractorsResult.data.find(s => 
                        s.subName === cleanedData.subName &&
                        s.address === cleanedData.address
                      );
                      if (foundSubcontractor) {
                        resolve({ success: true, data: foundSubcontractor });
                      } else {
                        reject(new Error('Could not verify subcontractor creation'));
                      }
                    } else {
                      reject(new Error('Failed to verify subcontractor creation'));
                    }
                  })
                  .withFailureHandler(error => reject(error))
                  .getSubcontractorsForClient();
              } else if (result && result.success) {
                resolve(result);
              } else {
                reject(new Error(result?.error || 'Server returned unsuccessful response'));
              }
            })
            .withFailureHandler(error => {
              console.error('Server error:', error);
              reject(new Error(error.message || 'Failed to create subcontractor'));
            })
            .createSubcontractor(cleanedData);
        });

        if (response.success) {
          showMessage('Subcontractor created successfully', 'success');
          setIsCreating(false);
          fetchSubcontractors(); // Refresh list
        } else {
          throw new Error(response.error || 'Failed to create subcontractor');
        }
      } catch (error) {
        console.error('Error creating subcontractor:', error);
        showMessage(error.message || 'Error creating subcontractor', 'error');
      } finally {
        setLoading(false);
      }
    };

    const handleUpdateSubcontractor = async (formData) => {
      setLoading(true);
      try {
        const response = await new Promise((resolve, reject) => {
          google.script.run
            .withSuccessHandler(resolve)
            .withFailureHandler(reject)
            .updateSubcontractor(formData);
        });

        if (response.success) {
          showMessage('Subcontractor updated successfully', 'success');
          setIsEditing(false);
          fetchSubcontractors();
          if (onUpdate) onUpdate('subcontractor');
        } else {
          throw new Error(response.error || 'Failed to update subcontractor');
        }
      } catch (error) {
        console.error('Error updating subcontractor:', error);
        showMessage(error.message || 'Error updating subcontractor', 'error');
      } finally {
        setLoading(false);
      }
    };

    // Phone number formatter
    const formatPhoneNumber = (value) => {
      const cleaned = value.replace(/\D/g, '');
      if (cleaned.length >= 10) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6,10)}`;
      } else if (cleaned.length > 6) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6)}`;
      } else if (cleaned.length > 3) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3)}`;
      } else if (cleaned.length > 0) {
        return `(${cleaned}`;
      }
      return cleaned;
    };

    // === Export Functionality ===
    const exportSubcontractorData = () => {
      const exportData = filteredSubcontractors.map(sub => ({
        'Subcontractor ID': sub.subId,
        'Name': sub.subName,
        'Email': sub.contactEmail,
        'Phone': sub.phone,
        'Total Projects': sub.metrics?.totalProjects || 0,
        'Active Projects': sub.metrics?.activeProjects || 0,
        'Total Revenue': sub.metrics?.totalRevenue || 0,
        'Status': sub.status || 'N/A'
      }));

      // Convert to CSV
      const headers = Object.keys(exportData[0]);
      const csvContent = [
        headers.join(','),
        ...exportData.map(row => 
          headers.map(header => 
            JSON.stringify(row[header] || '')
          ).join(',')
        )
      ].join('\n');

      // Create download link
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `subcontractor_data_${new Date().toISOString()}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    };

    // === Render Methods ===
    const renderHeader = () => {
      return React.createElement('div', { 
        className: 'flex flex-col sm:flex-row justify-between items-center gap-4 mb-6' 
      },
        React.createElement('h2', { 
          className: 'text-xl sm:text-2xl font-bold text-gray-900' 
        }, 'Subcontractor Management'),
        React.createElement('button', {
          onClick: () => setIsCreating(true),
          className: 'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700'
        }, 'Add New Subcontractor')
      );
    };

    const renderControls = () => {
      return React.createElement('div', { className: 'flex flex-col sm:flex-row justify-between gap-4 mb-6' },
        // Search and filters group
        React.createElement('div', { className: 'flex flex-col sm:flex-row gap-4' },
          React.createElement('input', {
            type: 'text',
            placeholder: 'Search subcontractors...',
            value: searchTerm,
            onChange: e => setSearchTerm(e.target.value),
            className: 'p-2 border rounded w-full sm:w-64'
          }),
          React.createElement('select', {
            value: statusFilter,
            onChange: e => setStatusFilter(e.target.value),
            className: 'p-2 border rounded w-full sm:w-auto'
          },
            React.createElement('option', { value: 'All' }, 'All Statuses'),
            React.createElement('option', { value: 'Active' }, 'Active'),
            React.createElement('option', { value: 'Inactive' }, 'Inactive')
          )
        )
      );
    };

    // Render subcontractor details view
    const renderSubcontractorDetails = () => {
      if (!selectedSubcontractor) return null;

      return React.createElement('div', { className: 'space-y-6' },
        // Header with back button
        React.createElement('div', { 
          className: 'flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6' 
        },
          React.createElement('h3', { className: 'text-xl font-bold' }, 
            `${selectedSubcontractor.subName} Details`
          ),
          React.createElement('button', {
            onClick: () => {
              setSelectedSubcontractor(null);
              setViewMode('list');
            },
            className: 'inline-flex items-center text-blue-600 hover:text-blue-800'
          }, 
            React.createElement('span', { className: 'mr-2' }, '←'),
            'Back to List'
          )
        ),

        // Contact Information Card
        React.createElement('div', { className: 'bg-white p-4 sm:p-6 rounded-lg shadow-sm' },
          React.createElement('h4', { className: 'font-semibold mb-4' }, 'Contact Information'),
          React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-4' },
            React.createElement('div', null,
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'Email:'),
              React.createElement('p', null, selectedSubcontractor.contactEmail || 'N/A')
            ),
            React.createElement('div', null,
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'Phone:'),
              React.createElement('p', null, selectedSubcontractor.phone || 'N/A')
            ),
            React.createElement('div', null,
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'Address:'),
              React.createElement('p', null, 
                [
                  selectedSubcontractor.address, 
                  selectedSubcontractor.city, 
                  selectedSubcontractor.state, 
                  selectedSubcontractor.zip
                ].filter(Boolean).join(', ') || 'N/A'
              )
            ),
            React.createElement('div', null,
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'Status:'),
              React.createElement('p', null, selectedSubcontractor.status || 'Unknown')
            )
          )
        ),

        // Subcontractor Metrics Card
        React.createElement('div', { className: 'bg-white p-4 sm:p-6 rounded-lg shadow-sm' },
          React.createElement('h4', { className: 'font-semibold mb-4' }, 'Subcontractor Metrics'),
          React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4' },
            React.createElement('div', null,
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'Total Projects:'),
              React.createElement('p', { className: 'text-lg font-semibold' }, 
                selectedSubcontractor.metrics?.totalProjects || 0
              )
            ),
            React.createElement('div', null,
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'Active Projects:'),
              React.createElement('p', { className: 'text-lg font-semibold' }, 
                selectedSubcontractor.metrics?.activeProjects || 0
              )
            ),
            React.createElement('div', null,
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'Total Revenue:'),
              React.createElement('p', { className: 'text-lg font-semibold' }, 
                new Intl.NumberFormat('en-US', {
                  style: 'currency',
                  currency: 'USD'
                }).format(selectedSubcontractor.metrics?.totalRevenue || 0)
              )
            ),
            React.createElement('div', null,
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'Avg Project Value:'),
              React.createElement('p', { className: 'text-lg font-semibold' }, 
                new Intl.NumberFormat('en-US', {
                  style: 'currency',
                  currency: 'USD'
                }).format(selectedSubcontractor.metrics?.averageProjectValue || 0)
              )
            )
          )
        ),
        isEditing ? 
          React.createElement(EditSubcontractorForm, {
            subcontractor: selectedSubcontractor,
            onSubmit: handleUpdateSubcontractor,
            onCancel: () => setIsEditing(false)
          }) :
          React.createElement(React.Fragment, null,
            // Add Edit button
            React.createElement('button', {
              onClick: () => setIsEditing(true),
              className: 'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700'
            }, 'Edit Subcontractor')
          )
      );
    };

    // Render the main view
    return React.createElement('div', { className: 'relative' },
      isCreating
        ? React.createElement(CreateSubcontractorForm, {
            onSubmit: handleCreateSubcontractor,
            onCancel: () => setIsCreating(false)
          })
        : React.createElement('div', { className: 'space-y-6' },
            renderHeader(),
            viewMode === 'details'
              ? renderSubcontractorDetails()
              : React.createElement(React.Fragment, null,
                  renderControls(),
                  React.createElement('div', { className: 'flex justify-end mb-4' },
                    React.createElement('button', {
                      onClick: exportSubcontractorData,
                      className: 'px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700'
                    }, 'Export CSV')
                  ),
                  React.createElement(StandardTable, {
                    columns: [
                      { key: 'subId', label: 'ID' },
                      { key: 'subName', label: 'Name' },
                      { key: 'contactEmail', label: 'Email' },
                      { key: 'phone', label: 'Phone' },
                      { 
                        key: 'status', 
                        label: 'Status', 
                        render: (sub) => React.createElement('span', {
                          className: `px-2 py-1 rounded text-xs ${
                            sub.status === 'Active' ? 'bg-green-100 text-green-800' :
                            sub.status === 'Inactive' ? 'bg-red-100 text-red-800' :
                            'bg-gray-100 text-gray-800'
                          }`
                        }, sub.status || 'Unknown')
                      }
                    ],
                    data: filteredSubcontractors,
                    onRowClick: (sub) => {
                      setSelectedSubcontractor(sub);
                      setViewMode('details');
                    }
                  })
                )
          )
    );
  };

  // Export to global window object
  if (typeof window !== 'undefined') {
    window.SubcontractorManagement = SubcontractorManagement;
  }
})();
</script>